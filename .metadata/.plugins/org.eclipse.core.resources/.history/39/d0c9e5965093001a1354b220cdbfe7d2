package pages;


import java.io.IOException;
import java.util.Map;

import org.testng.Assert;
import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.NoSuchElementException;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;
import cucumber.api.DataTable;
import junit.framework.Assert;
import utilPackage.baseclass;

public class TaskPage extends baseclass {

	public TaskPage() throws IOException {
	super();
	PageFactory.initElements(driver, this);
	explicitwait=new WebDriverWait(driver,80);

	}
	
	String addedtask;
	String addedtaskagy;
	public String assignto;
	boolean emp;
	boolean b;
	String title;
	String a;
	
	@FindBy(xpath="//button[@title='Add Task']")
	WebElement addtaskbtn;
	
	@FindBy(xpath="//input[@formcontrolname='Title']")
	WebElement titlebtn;
	
	@FindBy(xpath="//select[@formcontrolname='TeamId']")
	WebElement teamid;
	
	@FindBy(xpath="//select[@formcontrolname='AssignTo']")
	WebElement Assigntofield;
	
	@FindBy(xpath="//input[@formcontrolname='Status']")
	WebElement status;
	
	@FindBy(xpath="//textarea[@formcontrolname='Description']")
	WebElement notefield;
	
	@FindBy(xpath="//label[@for='test']")
	public WebElement mytask;
	
	@FindBy(xpath="//label[@for='test2']")
	public WebElement teamtask;
	
	@FindBy(xpath="//i[@class='fa fa-trash']")
	WebElement deletetaskbtn;
	
	@FindBy(xpath="//button[@id='confirmModalBtn']")
	WebElement confirmbtn;
	
	@FindBy(xpath="//button[@id='alertModalCloseBtn']")
	public WebElement okbtn;
	
	@FindBy(xpath="//button[@title='Edit Task']")
	public WebElement edittaskbtn;
	
	@FindBy(xpath="//strong[text()='Assign To: ']")
	public WebElement taskcard;
	
	@FindBy(xpath="//strong[text()=addedtask]")
	public WebElement taskname;
	
	@FindBy(xpath="//button[@title='Refresh'][@class='btn Cbtn-primary mr-1 float-right optbtn']")
	public WebElement reloadtaskbtn;
	
	public void reloadtask()
	{
		explicitwait.until(ExpectedConditions.elementToBeClickable(reloadtaskbtn));
		executor.executeScript("arguments[0].click();", reloadtaskbtn);
	}
	
	public void clickOnAddTaskBtn() throws InterruptedException
	{

		explicitwait.until(ExpectedConditions.elementToBeClickable(addtaskbtn));
		executor.executeScript("arguments[0].click();", addtaskbtn);
		
	}
	
	public void selectTeamId(DataTable credentials) throws InterruptedException
	{
		for (Map<String, String> data : credentials.asMaps(String.class, String.class))
		{
		Select dropdown = new Select(teamid);
		Thread.sleep(4000);
		//String value= prop.getProperty("employer");
		dropdown.selectByVisibleText(data.get("teamField"));
	}
	}
	
	public void selectAssignTo(DataTable credentials) throws InterruptedException
	{
		for (Map<String, String> data : credentials.asMaps(String.class, String.class))
		{
		Select dropdown = new Select(Assigntofield);
		Thread.sleep(4000);
		dropdown.selectByVisibleText(data.get("AssignTo"));
	    }
	}
	
	public void enterAlldetails(DataTable credentials) throws InterruptedException {
		
		for (Map<String, String> data : credentials.asMaps(String.class, String.class))
		{
			clickOnAddTaskBtn();	
			Thread.sleep(2000);
			titlebtn.sendKeys(data.get("Title for emp"));
			addedtask= titlebtn.getText();
			selectTeamId(credentials);
			Thread.sleep(1000);
			selectAssignTo(credentials);
			assignto= Assigntofield.getText();
			notefield.sendKeys(data.get("note"));
			employerspage.ClickSubmitBtn();
		}
		Thread.sleep(2000);
		employerspage.ClickCloseBtn();
	}
	
	public void edittaskdetailsforemp(DataTable credentials) throws InterruptedException {
		for (Map<String, String> data : credentials.asMaps(String.class, String.class))
		{		
			Thread.sleep(2000);
			titlebtn.clear();
			titlebtn.sendKeys(data.get("Title for emp"));
//			addedtask= titlebtn.getText();
//			selectTeamId(credentials);
//			Thread.sleep(1000);
//			selectAssignTo(credentials);
//			assignto= Assigntofield.getText();
			notefield.clear();
			notefield.sendKeys(data.get("note"));
			employerspage.ClickSubmitBtn();
			clickOnAddTaskBtn();
		}
		employerspage.ClickCloseBtn();
	}
	
	
	public void assertediteddetails(DataTable credentials) throws InterruptedException
	{
		
		for (Map<String, String> data : credentials.asMaps(String.class, String.class))
		{
			titlebtn.getText().contentEquals(data.get("Title for emp"));
//			title= titlebtn.getText();
//			a = "task1";
//			Assert.assertEquals(title, a);
////			Assert.assertEquals(title, a);
////			Assert.assertEquals(Assigntofield.getText(),data.get("AssignTo"));
////			Assert.assertEquals(notefield.getText(), prop.get("note"));
			
		}
	}
	
	
public void validateTaskDisplayingProperly()
{
	if(assignto.equals(prop.getProperty("employer")))
	{
		mytask.click();
		boolean b= driver.getPageSource().contentEquals(addedtask);
		System.out.println(b);
		Assert.assertEquals(b, true);
	}
	else if (assignto.equals(prop.getProperty("team")))
	{
		teamtask.click();
		boolean b= driver.getPageSource().contentEquals(addedtask);
		Assert.assertEquals(b, true);
	}
	
	
	}

public void ValidateTaskDisplayingForTeam()
{
	if(assignto.equals(prop.getProperty("team")))
	{
		mytask.click();
		boolean b= driver.getPageSource().contentEquals(addedtask);
		Assert.assertEquals(b, true);
	}
	else if(assignto.equals(prop.getProperty("employer")))
	{
		teamtask.click();
		boolean b= driver.getPageSource().contentEquals(addedtask);
		Assert.assertEquals(b, true);
	}

	}

	public void clickondeletetask() throws InterruptedException
	{
//		Thread.sleep(3000);
		explicitwait.until(ExpectedConditions.elementToBeClickable(deletetaskbtn));
		executor.executeScript("arguments[0].click();", deletetaskbtn);
		executor.executeScript("arguments[0].click();", confirmbtn);
		
	}
	
	
	public void ClickOnTeamTask() throws InterruptedException
	{
//		Thread.sleep(2000);
		explicitwait.until(ExpectedConditions.elementToBeClickable(teamtask));
		executor.executeScript("arguments[0].click();",teamtask);
	}
	
	public void ClickOnMyTask() throws InterruptedException
	{

		explicitwait.until(ExpectedConditions.elementToBeClickable(mytask));
		executor.executeScript("arguments[0].click();",mytask);
	}
	
	
	public void clickOKBtn()
	{
		explicitwait.until(ExpectedConditions.elementToBeClickable(okbtn));
		executor.executeScript("arguments[0].click();",okbtn);
	}
	
	public void ClickOnEditTask()
	{
		explicitwait.until(ExpectedConditions.elementToBeClickable(edittaskbtn));
		executor.executeScript("arguments[0].click();",edittaskbtn);
		

	}
	
	public void searchTask(DataTable credentials) throws InterruptedException 
	{
//		try {
//			
//		taskcard.isDisplayed();
//			
//		}
//		catch(NoSuchElementException e1)
//		{
//			teamtask.click();
//			
//			try {
//			
//				taskcard.isDisplayed();
//				
//			}
//			catch(NoSuchElementException e)
//			{
				this.emp=loginpage.b;
				System.out.println("emp "+emp);
				taskpage.clickOnAddTaskBtn();
				if(emp==true) 
				{
				taskpage.enterAlldetails(credentials);
				validateTaskDisplayingProperly();
				}
				else
				{
					taskpage.enterAlldetailsForAgy(credentials);
					validateTaskDisplayingProperlyForAgy();
				}
			}
			
//		}
//		
//	}
//	

	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
		
		
	
	
//------------------------------------------------------------------------------------------------------------------
	//For Agency






public void validateTaskDisplayingProperlyForAgy() throws InterruptedException
{
	
	System.out.println("----"+addedtaskagy);
	if(assignto.equals(prop.getProperty("agency")))
	{
		mytask.click();
		boolean b= driver.getPageSource().contentEquals(addedtaskagy);
		Assert.assertEquals(b, true);
	}
	else
	{
		Thread.sleep(1000);
		teamtask.click();
		boolean b= driver.getPageSource().contentEquals(addedtaskagy);
		Assert.assertEquals(b, true);
	}
}

public void TaskDisplayingForAgyTeam() throws InterruptedException
{
	if(assignto.equals(prop.getProperty("agency")))
	{
		teamtask.click();
		boolean b= driver.getPageSource().contentEquals(addedtaskagy);
		Assert.assertEquals(b, true);
	}
	else 
	{
		Thread.sleep(10000);
		mytask.click();
		boolean b= driver.getPageSource().contentEquals(addedtaskagy);
		Assert.assertEquals(b, true);
	}

	}

public void selectAgyTeamId(DataTable credentials) throws InterruptedException
{
	for (Map<String, String> data : credentials.asMaps(String.class, String.class))
	{
	Select dropdown = new Select(teamid);
//	String value= prop.getProperty("agency");
	Thread.sleep(2000);
	dropdown.selectByVisibleText(data.get("agency"));
}
}
public void selectAgyAssignTo(DataTable credentials)
{
	for (Map<String, String> data : credentials.asMaps(String.class, String.class))
	{

	Select dropdown = new Select(Assigntofield);
	dropdown.selectByVisibleText(data.get("agyAssignTo"));
}
}

public void enterAlldetailsForAgy(DataTable credentials) throws InterruptedException {
	
	for (Map<String, String> data : credentials.asMaps(String.class, String.class))
	{
		clickOnAddTaskBtn();
		explicitwait.until(ExpectedConditions.elementToBeClickable(titlebtn));		
		titlebtn.sendKeys(data.get("Title for agy"));
		addedtask= titlebtn.getText();
		System.out.println(addedtask);
		select = new Select(teamid);
	    explicitwait.until(ExpectedConditions.elementToBeClickable(teamid));
	    select.selectByVisibleText(data.get("agency"));
//		selectAgyAssignTo(credentials);
		Select dropdown1 = new Select(Assigntofield);
		dropdown1.selectByVisibleText(data.get("agyAssignTo"));
		assignto= Assigntofield.getText();
		notefield.sendKeys(data.get("agynote"));
		Thread.sleep(2000);
		employerspage.ClickSubmitBtn();
	}

}

public void assertediteddetailsForAgy(DataTable credentials) throws InterruptedException
{
	
	for (Map<String, String> data : credentials.asMaps(String.class, String.class))
	{
		titlebtn.getText().contentEquals(data.get("Title for agy"));
//		Assert.assertEquals(titlebtn.getText(), data.get("edited Title"));
//		Assert.assertEquals(teamid.getText(), data.get("agency"));
//		Assert.assertEquals(Assigntofield.getText(),data.get("agyAssignTo"));
//		Assert.assertEquals(notefield.getText(), data.get("agynote"));
		
	}
}
public void editTaskDetailsForAgy(DataTable credentials) throws InterruptedException {
	for (Map<String, String> data : credentials.asMaps(String.class, String.class))
	{
		Thread.sleep(2000);
		titlebtn.clear();
		titlebtn.sendKeys(data.get("Title for emp"));
//		addedtaskagy= titlebtn.getText();
//		System.out.println(addedtaskagy);
//		selectAgyTeamId(credentials);
//		Thread.sleep(1000);
//		selectAgyAssignTo(credentials);
//		assignto= Assigntofield.getText();
		notefield.clear();
		notefield.sendKeys(data.get("agynote"));
		employerspage.ClickSubmitBtn();
		clickOnAddTaskBtn();
	}
	employerspage.ClickCloseBtn();
	System.out.println(addedtaskagy);
}


}
